# Feature Specification: AI自助拍照机桌面应用

**Feature Branch**: `001-ai-photobooth`
**Created**: 2026-02-17
**Status**: Draft
**Input**: User description: "我要开发一个自助拍照机的桌面应用，利用AI生成图片的技术，提前设置场景和效果图，由用户选择期望的效果图。然后再将用户的人像通过AI技术实现整合。如果用户对实现效果不满意可以重新生成或者更换场景。功能需求：模式选择、效果选择、付费打印/下载、下载、打印"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 选择拍照模式 (Priority: P1)

用户到达自助拍照机前，首先在主界面选择期望的拍照风格模式。

**Why this priority**: 这是用户使用流程的起点，用户必须先选择模式才能继续后续操作。

**Independent Test**: 用户打开应用后可看到所有可选模式，选择后进入效果预览界面。

**Acceptance Scenarios**:

1. **Given** 用户打开应用，**When** 应用加载完成，**Then** 显示所有可选模式列表
2. **Given** 用户点击某一模式，**When** 模式被选中，**Then** 进入该模式的效果预览界面
3. **Given** 用户选择支持多人模式，**When** 进入拍照界面，**Then** 支持2-3人同框拍摄

---

### User Story 2 - 预览并选择效果 (Priority: P1)

用户选择模式后，可以预览该模式下的各种效果缩略图，选择心仪的效果后进行拍照。

**Why this priority**: 效果选择是核心功能，用户需要看到效果预览才能做出选择。

**Independent Test**: 用户在效果预览界面可以选择效果并看到实时预览，确认后进行拍摄。

**Acceptance Scenarios**:

1. **Given** 用户进入某模式的效果预览界面，**When** 加载效果列表，**Then** 显示该模式下所有可用效果的缩略图
2. **Given** 用户点击某一效果，**When** 效果被选中，**Then** 该效果高亮显示为当前选中状态
3. **Given** 用户对当前效果不满意，**When** 点击重新生成按钮，**Then** 系统重新生成该效果并更新预览

---

### User Story 3 - 拍照与AI合成 (Priority: P1)

用户确认效果后进行拍照，系统通过AI技术将用户人像与选定的场景效果进行合成。

**Why this priority**: 这是核心价值交付，用户完成拍照并获得合成照片。

**Independent Test**: 用户拍照后可以立即看到AI合成的成品照片。

**Acceptance Scenarios**:

1. **Given** 用户确认效果后点击拍摄按钮，**When** 倒计时结束拍照完成，**Then** 系统显示拍摄中的提示
2. **Given** 拍照完成，**When** AI开始合成处理，**Then** 显示合成进度
3. **Given** AI合成完成，**When** 系统显示合成结果，**Then** 用户可以预览最终效果
4. **Given** 用户对合成效果不满意，**When** 点击重新生成，**Then** 重新进行AI合成
5. **Given** 用户对合成效果不满意，**When** 点击更换场景，**Then** 返回效果选择界面

---

### User Story 4 - 付费下载 (Priority: P1)

用户对合成效果满意后，可以选择下载照片，需要通过微信扫码授权并完成支付。

**Why this priority**: 下载是核心变现功能，必须支持微信支付。

**Independent Test**: 用户可以通过扫描二维码完成微信授权登录和支付。

**Acceptance Scenarios**:

1. **Given** 用户点击下载按钮，**When** 进入支付界面，**Then** 显示二维码和支付金额
2. **Given** 用户使用微信扫描二维码，**When** 微信授权成功，**Then** 显示支付确认界面
3. **Given** 用户完成支付，**When** 支付成功，**Then** 生成下载订单并显示下载入口
4. **Given** 用户在订单查询界面，**When** 输入订单信息，**Then** 显示对应的下载链接

---

### User Story 5 - 现场打印 (Priority: P2)

用户可以选择现场打印照片，打印价格与下载不同。

**Why this priority**: 现场打印是自助拍照机的重要线下场景，提供差异化定价。

**Independent Test**: 用户完成支付后可以直接打印照片。

**Acceptance Scenarios**:

1. **Given** 用户点击打印按钮，**When** 进入打印支付界面，**Then** 显示打印价格（二维码）
2. **Given** 用户完成打印支付，**When** 支付成功，**Then** 系统发送打印任务到打印机
3. **Given** 打印机就绪，**When** 打印完成，**Then** 提示用户取走照片

---

### Edge Cases

- 多人拍照时，如何处理人数检测失败的情况
- AI合成处理失败时的错误提示和重试机制
- 支付超时或失败的处理流程
- 打印机缺纸或故障时的提示
- 网络连接中断时的离线处理方案
- 用户未支付离开时的订单保留策略

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统 MUST 提供至少6种拍照模式供用户选择，包括卡通模式、电影海报模式、二次元动漫、赛博朋克、古装风格、年龄变化
- **FR-002**: 系统 MUST 支持2-3人同框拍照
- **FR-003**: 系统 MUST 在用户选择模式后显示该模式下的所有效果预览缩略图
- **FR-004**: 系统 MUST 支持用户切换已选效果后重新生成合成图像
- **FR-005**: 系统 MUST 提供微信扫码授权登录功能用于身份验证
- **FR-006**: 系统 MUST 支持扫码支付，区分下载和打印两种价格
- **FR-007**: 系统 MUST 在用户支付成功后生成可查询的订单
- **FR-008**: 系统 MUST 提供订单查询功能，用户可通过订单下载照片
- **FR-009**: 系统 MUST 支持调用本地打印机进行现场打印
- **FR-010**: 系统 MUST 在AI合成过程中显示进度反馈
- **FR-011**: 系统 MUST 允许用户在合成效果不满意时重新生成或更换场景
- **FR-012**: 系统 MUST 在网络异常时提供友好的错误提示

### Key Entities

- **拍照模式**: 预设的风格类型，如卡通、电影海报、二次元等，每个模式包含多个效果变体
- **效果配置**: 每种模式下的具体效果参数，包括场景模板、效果参数等
- **拍照订单**: 记录用户的拍照信息、选择的模式/效果、支付状态、生成的照片等
- **用户会话**: 记录当前用户的操作状态，包括已选模式、已选效果、当前进度等

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户可以在5分钟内完成从选择模式到获得成片的完整流程
- **SC-002**: 系统支持至少100种不同的效果组合（6种模式 × 多种效果）
- **SC-003**: 90%的用户在首次使用可以顺利完成拍照流程
- **SC-004**: AI合成处理时间不超过30秒
- **SC-005**: 支付成功率不低于99%
- **SC-006**: 打印功能在正常网络和打印机状态下成功率达到95%以上
